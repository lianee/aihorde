<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AI Horde - Workers</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="darkreader-lock">
    <link rel="stylesheet" href="">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons|Material+Icons+Outlined" rel="stylesheet" type="text/css">
    <link href="https://cdn.jsdelivr.net/npm/quasar@2/dist/quasar.prod.css" rel="stylesheet" type="text/css">
    <style>
        .q-header {
            background-color: #eee;
            color: black;
        }

        body.body--dark .q-header {
            background-color: #080808;
            color: white;
        }

        .q-tr:not(.details) {
            cursor: pointer;
        }

        tbody tr.search_positive td:after,
        tbody tr.search_warning td:after {
            content: '';
            opacity: .4
        }

        .q-table--dark tbody tr.search_positive td:after,
        .q-table--dark tbody tr.search_warning td:after {
            opacity: .1
        }

        tbody tr.search_positive td:after {
            background-color: var(--q-positive);
        }

        tbody tr.search_warning td:after {
            background-color: var(--q-warning);
        }

        .q-table tbody td.tdIcon {
            font-size: 1.5em;
        }

        .text2x {
            font-size: 2em;
        }

        .model-aphrodite,
        .model-kobold,
        .model-pygmalion {
            height: 2em;
            background-position: center;
            background-repeat: no-repeat;
            background-size: contain;
        }

        .model-aphrodite {
            background-image: url("public/aphrodite.svg");
        }

        .model-pygmalion {
            background-image: url("public/pygmalion.svg");
        }

        .model-kobold {
            background-image: url("public/kobold.svg");
        }

        .body--dark svg.icon path {
            fill: white;
        }

        .body--dark .model-aphrodite {
            background-image: url("public/aphrodite-dark.svg");
        }

        .body--dark .model-kobold {
            background-image: url("public/kobold-dark.svg");
        }

        body.body--dark .q-btn.bg-dark {
            background-color: black !important;
        }

        body.body--dark .q-layout__shadow::after {
            box-shadow: 0 0 10px 2px #0003, 0 0px 10px #0000003d;
        }

        body.body--dark .shadow-2 {
            box-shadow: 0 1px 5px hsla(0, 0%, 0%, .2), 0 2px 2px hsla(0, 0%, 0%, .14), 0 3px 1px -2px hsla(0, 0%, 0%, .12);
        }

        .q-table--dark,
        .q-table__card--dark {
            box-shadow: 0 1px 5px hsla(0, 0%, 0%, .2), 0 2px 2px hsla(0, 0%, 0%, .14), 0 3px 1px -2px hsla(0, 0%, 0%, .12);
        }

        .q-card--dark {
            border-color: #00000047;
            box-shadow: 0 1px 5px #0003, 0 2px 2px #00000024, 0 3px 1px -2px #0000001f;
        }
    </style>
</head>

<body>
    <div id="q-app">
        <q-layout view="hHh lpR fFf" v-cloak>
            <q-header reveal elevated>
                <q-toolbar>
                    <q-toolbar-title :shrink="true">
                        <div class="logo"></div>
                    </q-toolbar-title>
                    <div class="col text-h4 text-center">AI Horde</div>
                </q-toolbar>
                <q-tabs align="left" v-model="tab">
                    <q-tab name="workers" label="Workers"></q-tab>
                    <q-tab name="models" label="Models"></q-tab>
                    <q-tab name="alerts" label="Alerts"></q-tab>
                </q-tabs>
            </q-header>

            <q-page-container>
                <q-page padding>
                    <q-tab-panels v-model="tab" animated class="shadow-2 rounded-borders">
                        <q-tab-panel name="workers">
                            <p>
                                Currently active workers found at the <a href="https://aihorde.net/" target="_blank">AI Horde</a> project. Updates every minute. <a href="https://github.com/lianee/aihorde" target="github"><svg class="icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 16 16" fill="none">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58.0.0 3.67055.0 8.20235.0 11.8319 2.29 14.8975 5.47 15.9843 5.87 16.0561 6.02 15.81 6.02 15.5947 6.02 15.3999 6.01 14.754 6.01 14.067 4 14.4464 3.48 13.5646 3.32 13.1033 3.23 12.8674 2.84 12.1395 2.5 11.9447 2.22 11.7909 1.82 11.4115 2.49 11.4013 3.12 11.391 3.57 11.9959 3.72 12.242 4.44 13.4826 5.59 13.134 6.05 12.9187 6.12 12.3855 6.33 12.0267 6.56 11.8216c-1.78-.205-3.64-.9125-3.64-4.04987.0-.89201.31-1.63022.82-2.20438C3.66 5.36229 3.38 4.52155 3.82 3.39372c0 0 .67-.21531 2.2.84074C6.66 4.04991 7.34 3.95763 8.02 3.95763S9.38 4.04991 10.02 4.23446c1.53-1.0663 2.2-.84074 2.2-.84074C12.66 4.52155 12.38 5.36229 12.3 5.56735 12.81 6.14151 13.12 6.86947 13.12 7.77173c0 3.14767-1.87 3.84487-3.65 4.04987C9.76 12.078 10.01 12.5701 10.01 13.3391 10.01 14.4361 10 15.3179 10 15.5947 10 15.81 10.15 16.0664 10.55 15.9843 13.71 14.8975 16 11.8216 16 8.20235 16 3.67055 12.42.0 8 0z" fill="#000"></path>
                                    </svg> Github</a>
                            </p>
                            <div>
                                <q-checkbox v-model="prefs.trusted" inline="" toggle-indeterminate="">Trusted</q-checkbox>
                                <q-checkbox v-model="prefs.maintenance" inline="" toggle-indeterminate="">Maintenance</q-checkbox>
                                <q-checkbox v-model="prefs.img2img" inline="" toggle-indeterminate="">img2img</q-checkbox>
                                <q-checkbox v-model="prefs.painting" inline="" toggle-indeterminate="">painting</q-checkbox>
                                <q-checkbox v-model="prefs.lora" inline="" toggle-indeterminate="">lora</q-checkbox>
                            </div>
                            <div>
                                <q-checkbox inline="" v-model="prefs.typeImage">Dreamer ({{ wCount.image }})</q-checkbox>
                                <q-checkbox inline="" v-model="prefs.typeText">Scribe ({{ wCount.text }})</q-checkbox>
                                <q-checkbox inline="" v-model="prefs.typeInterrogation">Alchemist ({{ wCount.interrogation }})</q-checkbox>
                            </div>
                            <q-table :dense="$q.screen.lt.md" :columns="wFields" :rows="wDisplay" row-key="id" hide-bottom :pagination="prefs.wPagination" @update:pagination="wUpdatePagination">
                                <template v-slot:top-right>
                                    <q-input borderless dense debounce="300" v-model="prefs.wFilter" placeholder="Search">
                                        <template v-slot:append>
                                            <q-icon name="search" />
                                        </template>
                                    </q-input>
                                </template>
                                <template v-slot:body="props">
                                    <q-tr :props="props" @click="wRowClicked(props.row)" :class="'search_' + props.row._search">
                                        <q-td key="index" :props="props">
                                            {{ props.rowIndex + 1 }}
                                        </q-td>
                                        <q-td key="type" :props="props">
                                            <span v-if="props.row.type=='image'" class="material-icons-outlined" title="Dreamer">image</span>
                                            <span v-else-if="props.row.type=='text'" class="material-icons-outlined" title="Scribe">chat</span>
                                            <span v-else-if="props.row.type=='interrogation'" class="material-icons-outlined" title="Alchemist">image_search</span>
                                        </q-td>
                                        <q-td key="name" :props="props">
                                            {{ props.row.name }}
                                        </q-td>
                                        <q-td key="bridge_agent" :props="props">
                                            <span v-if="props.row.bridge_agent.indexOf('reGen')!=-1" class="material-icons-outlined" :title="'regen' + (props.row.maintenance_mode ? ' maintenance' : '')">bug_report</span>
                                            <span v-else class="material-icons-outlined" :title="'legacy' + (props.row.maintenance_mode ? ', maintenance mode' : '')">verified</span>
                                        </q-td>
                                        <q-td key="trusted" :props="props">
                                            <span v-if="props.row.trusted" class="material-icons-outlined">done</span>
                                            <span v-else class="material-icons-outlined">close</span>
                                        </q-td>
                                        <q-td key="img2img" :props="props">
                                            <span v-if="props.row.type!='image'">-</span>
                                            <span v-else-if="props.row.img2img" class="material-icons-outlined">done</span>
                                            <span v-else class="material-icons-outlined">close</span>
                                        </q-td>
                                        <q-td key="painting" :props="props">
                                            <span v-if="props.row.type!='image'">-</span>
                                            <span v-else-if="props.row.painting" class="material-icons-outlined">done</span>
                                            <span v-else class="material-icons-outlined">close</span>
                                        </q-td>
                                        <q-td key="lora" :props="props">
                                            <span v-if="props.row.type!='image'">-</span>
                                            <span v-else-if="props.row.lora" class="material-icons-outlined">done</span>
                                            <span v-else class="material-icons-outlined">close</span>
                                        </q-td>
                                        <q-td key="max_pixels" :props="props">
                                            <span v-if="props.row.type!='image'">-</span>
                                            <span v-else>{{ Math.round(props.row.max_pixels / 32768) }}</span>
                                        </q-td>
                                        <q-td key="threads" :props="props">
                                            <span>{{ props.row.threads }}</span>
                                        </q-td>
                                        <q-td key="models" :props="props">
                                            <span v-if="props.row.type=='interrogation'">-</span>
                                            <span v-else-if="props.row.type=='image'">{{ props.row.models.length}}</span>
                                            <div class="model-aphrodite text-center" v-else-if="props.row.type=='text' && props.row.models[0].toLowerCase().indexOf('aphrodite')==0" :title="props.row.models[0]"></div>
                                            <div class="model-kobold text-center" v-else-if="props.row.type=='text' && (props.row.models[0].toLowerCase().indexOf('kobold')==0 || props.row.models[0].toLowerCase().indexOf('henk717')==0)" :title="props.row.models[0]"></div>
                                            <div class="model-pygmalion text-center" v-else-if="props.row.type=='text' && props.row.models[0].toLowerCase().indexOf('pygmalion')==0" :title="props.row.models[0]"></div>
                                            <div v-else-if="props.row.type=='text'" class="text-center"><span class="material-icons-outlined text2x" :title="props.row.models[0]">help</span></div>
                                        </q-td>
                                        <q-td key="uptime" :props="props">
                                            {{ convertTime(props.row.uptime) }}
                                        </q-td>
                                        <q-td key="kudos_rewards" :props="props">
                                            {{ new Intl.NumberFormat().format(props.row.kudos_rewards) }}
                                        </q-td>
                                        <q-td key="k/h" :props="props">
                                            {{ new Intl.NumberFormat().format(Math.round(props.row.kudos_rewards / (props.row.uptime / 3600))) }}
                                        </q-td>
                                    </q-tr>
                                    <q-tr v-show="props.row._showDetails" :props="props" class="details">
                                        <q-td colspan="100%">
                                            <q-btn v-if="props.row.type=='image'" :href="'https://grafana.aihorde.net/d/XSx96LYVk/workers-image?orgId=1&var-worker=' + encodeURI(props.row.name)" target="grafana" icon="show_chart">Grafana</q-btn>
                                            <q-btn v-if="props.row.type=='text'" :href="'https://grafana.aihorde.net/d/f60735cb-12bd-4759-b77f-d1fdf53cf0e7/workers-text?orgId=1&var-worker=' + encodeURI(props.row.name)" target="grafana" icon="show_chart">Grafana</q-btn>
                                            <pre>{{ Object.fromEntries(Object.entries(props.row).filter(([k, v]) => k[0] != "_")) }}</pre>
                                        </q-td>
                                    </q-tr>
                                </template>
                            </q-table>
                        </q-tab-panel>
                        <q-tab-panel name="models">
                            <q-table :dense="$q.screen.lt.md" :columns="mFields" :rows="shModels" row-key="name" :pagination="prefs.mPagination" @update:pagination="mUpdatePagination" :filter="prefs.mFilter">
                                <template v-slot:top-right>
                                    <q-input borderless dense debounce="300" v-model="prefs.mFilter" placeholder="Filter">
                                        <template v-slot:append>
                                            <q-icon name="search" />
                                        </template>
                                    </q-input>
                                </template>
                                <template v-slot:body="props">
                                    <q-tr :props="props" @click="mRowClicked(props.row)" :class="'search_' + props.row._search">
                                        <q-td key="type" :props="props">
                                            <span v-if="props.row.type=='text'" class="material-icons-outlined" title="text">chat</span>
                                            <span v-else-if="props.row.more && props.row.more.showcases" class="material-icons-outlined" title="image">image_search</span>
                                            <span v-else class="material-icons-outlined" title="image">image</span>
                                        </q-td>
                                        <q-td key="name" :props="props" :title="props.row.more ? props.row.more.description : ''">
                                            {{ props.row.name }}
                                        </q-td>
                                        <q-td key="jobs" :props="props">
                                            {{ props.row.jobs }}
                                        </q-td>
                                        <q-td key="eta" :props="props">
                                            {{ props.row.eta }}
                                        </q-td>
                                        <q-td key="performance" :props="props">
                                            {{ new Intl.NumberFormat().format(props.row.performance) }}
                                        </q-td>
                                        <q-td key="workers" :props="props">
                                            {{ props.row.workers.length }}
                                        </q-td>
                                    </q-tr>
                                    <q-tr v-show="props.row._showDetails" :props="props" class="details">
                                        <q-td colspan="100%">
                                            <q-btn v-if="props.row.type=='image'" :href="'https://grafana.aihorde.net/d/LlcCf5Y4z/models-image?orgId=1&var-modelname=' + encodeURI(props.row.name)" target="grafana" icon="show_chart">Grafana</q-btn>
                                            <q-btn v-if="props.row.type=='text'" :href="'https://grafana.aihorde.net/d/a462fc45-bf98-42db-a2a6-2d93b58eda06/models-text?orgId=1&var-modelname=' + encodeURI(props.row.name)" target="grafana" icon="show_chart">Grafana</q-btn>
                                            <div v-if="props.row.more && props.row.more.showcases" v-for="(src, idx) in props.row.more.showcases" :key="idx">
                                                <q-img :src="src"></q-img>
                                            </div>
                                            <pre>{{ Object.fromEntries(Object.entries(props.row).filter(([k, v]) => k[0] != "_")) }}</pre>
                                        </q-td>
                                    </q-tr>
                                </template>
                            </q-table>
                        </q-tab-panel>
                        <q-tab-panel name="alerts">
                            <p>Receive an email and/or a notification whenever a worker change status (online or offline).<br />All data is stored only in your browser, you can run this tool locally without web server</p>
                            <div class="q-mt-md">Create a free account at <a href="https://www.smtp2go.com/" target="smtp2go">SMTP2GO</a>, set your email as a "verified sender" and create an API key</div>
                            <q-input v-model="prefs.apiKey" type="password" label="API key"></q-input>
                            <div class="q-mt-md">Destination</div>
                            <q-input v-model="prefs.email" type="email" label="Email" :rules="[value => testPattern.email(value) || 'incorrect email']" hint="Sender and recipent of the alert, must be a 'verified sender'"></q-input>
                            <div class="q-mt-md"><q-btn v-on:click="testEmail" :loading="sendingMail" :disabled="sendingMail || !(prefs.apiKey && prefs.email)">Send test email</q-btn></div>
                            <div class="q-mt-md"><q-btn icon="add" v-on:click="addWatched"></q-btn> Workers to watch (exact name only)</div>
                            <div v-for="(w, idx) in prefs.watched" :key="idx">
                                <q-input v-model.trim="prefs.watched[idx]" :rules="[value => checkOnline(value) || 'Offline or unknown']" debounce="500">
                                    <template v-slot:append>
                                        <q-btn icon="delete" v-on:click="deleteWatched(idx)" />
                                    </template>
                                </q-input>
                            </div>
                        </q-tab-panel>
                    </q-tab-panels>
                </q-page>
            </q-page-container>
        </q-layout>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quasar@2/dist/quasar.umd.prod.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quasar@2/dist/lang/fr.umd.prod.js"></script>
    <script>
        var app = Vue.createApp({
            setup () {
                Quasar.Dark.set('auto')

                const tab = Vue.ref('workers')
                const shWorkers = Vue.ref([])
                const shModels = Vue.ref([])
                const prefs = Vue.ref({
                    // workers
                    trusted: null,
                    maintenance: null,
                    img2img: null,
                    painting: null,
                    lora: null,
                    typeImage: true,
                    typeText: false,
                    typeInterrogation: false,
                    wFilter: "",
                    wPagination: {
                        sortBy: "k/h",
                        descending: true,
                        rowsPerPage: 0
                    },
                    // models
                    mFilter: "",
                    mPagination: {
                        sortBy: "name",
                        descending: false,
                        rowsPerPage: 20,
                    },
                    // alarm settings
                    watched: [],
                    apiKey: null,
                    email: null
                })
                const watchedStatus = Vue.ref({})

                const LOCAL_STORAGE_KEY = "aihorde:prefs"
                let data = window.localStorage.getItem(LOCAL_STORAGE_KEY)
                if (data) {
                    let x = JSON.parse(data)
                    if (x) {
                        if (!Array.isArray(x.watched)) x.watched = []
                        if (!x.wPagination) x.wPagination = { rowsPerPage: 0 }
                        prefs.value = x
                    }
                }
                window.addEventListener("beforeunload", () => {
                    window.localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(prefs.value))
                })

                const nbrFiltered = Vue.ref(0)

                const checkOnline = (name) => {
                    return shWorkers.value.findIndex(w => {
                        return w.name == name
                    }) != -1
                }

                const sendingMail = Vue.ref(false)
                const sendMail = async message => {
                    if (prefs.value.apiKey && prefs.value.email) {
                        sendingMail.value = true
                        const response = await fetch("https://api.smtp2go.com/v3/email/send", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                api_key: prefs.value.apiKey,
                                to: [prefs.value.email],
                                sender: prefs.value.email,
                                subject: "AI Horde worker alert",
                                text_body: message,
                            }),
                        })
                        let resp = await response.json() // parses JSON response into native
                        console.log(resp)
                        sendingMail.value = false
                    }
                }

                // Notifications require https
                if (location.protocol == 'https:' && Notification.permission == "default") {
                    Notification.requestPermission()
                }

                const fetchAPI = async (url) => {
                    let response = await fetch(url)
                    return await response.json()
                }

                const checkCount = Vue.ref(3)
                const wUpdateData = async () => {
                    let wDetails = shWorkers.value
                        .filter((w) => {
                            return w._showDetails
                        })
                        .map((w) => w.id)
                    let mDetails = shModels.value
                        .filter((m) => {
                            return m._showDetails
                        })
                        .map((m) => m.name)
                    const responses = await Promise.all([
                        fetchAPI("https://aihorde.net/api/v2/workers"),
                        fetchAPI("https://aihorde.net/api/v2/status/models?type=image"),
                        fetchAPI("https://aihorde.net/api/v2/status/models?type=text"),
                        fetchAPI("https://raw.githubusercontent.com/Haidra-Org/AI-Horde-image-model-reference/main/stable_diffusion.json")
                    ])
                    const workers = responses[0]
                    const wModels = {}
                    shWorkers.value = workers.map((w) => {
                        if (wDetails.indexOf(w.id) != -1) {
                            w._showDetails = true
                        }
                        if (w.models) {
                            w.models.sort((a, b) => {
                                return a.localeCompare(b)
                            })
                            w.models.forEach(m => {
                                if (!wModels[m]) wModels[m] = []
                                wModels[m].push(w.name)
                            })
                        }
                        return w
                    })
                    const models = responses[1].concat(responses[2])
                    shModels.value = models.map(m => {
                        if (mDetails.indexOf(m.name) != -1) {
                            m._showDetails = true
                        }
                        if (!Array.isArray(wModels[m.name])) wModels[m.name] = []
                        m.workers = wModels[m.name].sort((a, b) => {
                            return a.localeCompare(b)
                        })
                        if (responses[3][m.name]) {
                            m.more = responses[3][m.name]
                        }
                        return m
                    })
                    const changed = {}
                    prefs.value.watched.forEach(w => {
                        let online = checkOnline(w)
                        if (watchedStatus.value[w] == undefined) watchedStatus.value[w] = online
                        if (watchedStatus.value[w] != online) changed[w] = online
                    })
                    if (Object.keys(changed).length) {
                        checkCount.value -= 1
                        console.log('change detected', changed, 'count', checkCount.value)
                        if (checkCount.value < 1) {
                            let message = Object.entries(changed).map(([k, v]) => {
                                watchedStatus.value[k] = v
                                return 'Worker ' + k + ' is ' + (v ? 'online' : 'offline')
                            }).join("\n")
                            console.log(message)
                            sendMail(message)
                            if (Notification.permission == "granted") {
                                const notification = new Notification("AI Horde worker alert", {
                                    body: message,
                                })
                            }
                            checkCount.value = 3
                        }
                    } else {
                        checkCount.value = 3
                    }
                }

                wUpdateData()
                setInterval(wUpdateData, 60 * 1000)

                const convertTime = (secs) => {
                    let s = secs % 60
                    secs = Math.floor(secs / 60)
                    let m = secs % 60
                    secs = Math.floor(secs / 60)
                    let h = secs % 24
                    secs = Math.floor(secs / 24)
                    let d = secs
                    if (!d) {
                        if (!h) {
                            return m + "m"
                        }
                        return h + "h " + m + "m"
                    } else {
                        return d + "d " + h + "h " + m + "m"
                    }
                }

                return {
                    testPattern: Quasar.patterns.testPattern,
                    tab,
                    shWorkers,
                    shModels,
                    wCount: Vue.computed(() => {
                        return shWorkers.value.reduce((acc, val) => {
                            if (!acc[val.type]) acc[val.type] = 1
                            else acc[val.type]++
                            return acc
                        }, {})
                    }),
                    wDisplay: Vue.computed(() => {
                        return shWorkers.value.filter(w => {
                            let result = true
                            if (w.type == "image") {
                                if (prefs.value.img2img !== null && prefs.value.img2img != w.img2img) result = false
                                if (prefs.value.painting !== null && prefs.value.painting != w.painting) result = false
                                if (prefs.value.lora !== null && prefs.value.lora != w.lora) result = false
                                if (!prefs.value.typeImage) result = false
                            }
                            if (w.type == "text" && !prefs.value.typeText) result = false
                            if (w.type == "interrogation" && !prefs.value.typeInterrogation) result = false
                            if (prefs.value.trusted !== null && prefs.value.trusted != w.trusted) result = false
                            if (prefs.value.maintenance !== null && prefs.value.maintenance != w.maintenance_mode) result = false
                            return result
                        }).map((w) => {
                            if (prefs.value.wFilter && w.name.toLowerCase().indexOf(prefs.value.wFilter.toLowerCase()) != -1) {
                                if (w.maintenance_mode) {
                                    w._search = "warning"
                                } else {
                                    w._search = "positive"
                                }
                            } else {
                                w._search = null
                            }
                            return w
                        })
                    }),
                    prefs,
                    nbrFiltered,
                    onFiltered (filteredItems, nbr) {
                        nbrFiltered.value = nbr
                    },
                    convertTime,
                    mFields: [
                        {
                            name: "type",
                            field: "type",
                            label: "",
                            classes: (row) => 'tdIcon ' + (row.more ? (row.more.nsfw ? "text-warning" : "text-positive") : '')
                        },
                        {
                            name: "name",
                            label: "Name",
                            field: "name",
                            align: "left",
                            sortable: true
                        },
                        { // The job count waiting to be generated by this model.
                            name: "jobs",
                            label: "Jobs",
                            field: "jobs",
                            align: "right",
                            sortable: true
                        },
                        { // Estimated time in seconds for this model's queue to be cleared.
                            name: "eta",
                            label: "ETA",
                            field: "eta",
                            align: "right",
                            sortable: true
                        },
                        { // The average speed of generation for this model.
                            name: "performance",
                            label: "Performance",
                            field: "performance",
                            align: "right",
                            sortable: true
                        },
                        {
                            name: "workers",
                            label: "Workers",
                            field: (row) => row.workers.length,
                            align: "right",
                            sortable: true
                        },
                    ],
                    wFields: Vue.computed(() => {
                        let fields = [
                            {
                                name: "index",
                                label: "",
                                align: "right",
                            },
                            {
                                name: "type",
                                field: "type",
                                label: "",
                                classes: (row) => 'tdIcon ' + (row.type == 'image' ? (row.nsfw ? "text-warning" : "text-positive") : '')
                            },
                            {
                                name: "name",
                                label: "Name",
                                field: "name",
                                align: "left",
                                sortable: true
                            },
                            {
                                name: "bridge_agent",
                                label: "Worker",
                                field: "bridge_agent",
                                align: "center",
                                classes: (row) => 'tdIcon ' + (row.maintenance_mode ? "text-negative" : "text-positive")
                            },
                            {
                                name: "trusted",
                                field: "trusted",
                                label: "Trusted",
                                sortable: true,
                                align: "center",
                                classes: (row) => 'tdIcon ' + (row.trusted ? "text-positive" : "text-warning"),
                            },
                        ]
                        if (prefs.value.typeImage) {
                            fields = fields.concat([
                                {
                                    name: "img2img",
                                    label: "img2img",
                                    field: "img2img",
                                    sortable: true,
                                    align: "center",
                                    classes: (row) => row.type == 'image' ? 'tdIcon ' + (row.img2img ? "text-positive" : "text-warning") : ''
                                },
                                {
                                    name: "painting",
                                    label: "painting",
                                    field: "painting",
                                    sortable: true,
                                    align: "center",
                                    classes: (row) => row.type == 'image' ? 'tdIcon ' + (row.painting ? "text-positive" : "text-warning") : ''
                                },
                                {
                                    name: "lora",
                                    label: "lora",
                                    field: "lora",
                                    sortable: true,
                                    align: "center",
                                    classes: (row) => row.type == 'image' ? 'tdIcon ' + (row.lora ? "text-positive" : "text-warning") : ''
                                },
                                {
                                    name: "max_pixels",
                                    label: "Size",
                                    field: "max_pixels",
                                    align: "right",
                                    sortable: true,
                                },
                            ])
                        }
                        fields = fields.concat([
                            {
                                name: "threads",
                                label: "Threads",
                                field: "threads",
                                align: "right",
                                sortable: true,
                            },
                            {
                                name: "models",
                                label: "Models",
                                field: row => { if (row.models) return row.models.length },
                                align: "right",
                                sortable: true,
                            },
                            {
                                name: "uptime",
                                label: "Uptime",
                                field: "uptime",
                                align: "right",
                                class: "text-nowrap",
                                sortable: true,
                            },
                            {
                                name: "kudos_rewards",
                                label: "Kudos",
                                field: "kudos_rewards",
                                align: "right",
                                class: "text-nowrap",
                                sortable: true,
                            },
                            {
                                name: "k/h",
                                label: "k/h",
                                align: "right",
                                field: row => Math.round(row.kudos_rewards / (row.uptime / 3600)),
                                sortable: true,
                                sortByFormatted: true,
                            },
                        ])

                        return fields
                    }),
                    wRowClicked (row) {
                        row._showDetails = !row._showDetails
                    },
                    wUpdatePagination (pagination) {
                        prefs.value.wPagination = pagination
                    },
                    mRowClicked (row) {
                        row._showDetails = !row._showDetails
                    },
                    mUpdatePagination (pagination) {
                        prefs.value.mPagination = pagination
                    },
                    addWatched () {
                        prefs.value.watched.push('')
                    },
                    deleteWatched (idx) {
                        prefs.value.watched.splice(idx, 1)
                    },
                    checkOnline,
                    sendingMail,
                    testEmail () {
                        sendMail("This is a test email")
                    }
                }
            }
        })
        app.use(Quasar)
        app.mount('#q-app')
    </script>
</body>

</html>